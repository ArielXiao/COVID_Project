--COVID Data Exploration 

--Death Table Exploration
 SELECT * 
 FROM `brave-watch-343605.COVID_data.Death`
 WHERE continent is not null 
 ORDER BY 3,4


--Vaccination Table Exploration
SELECT *
FROM `brave-watch-343605.COVID_data.Vaccinations`
WHERE continent is not null
ORDER BY 3,4

--Select specific data to start with
SELECT location, date, total_cases, new_cases, total_deaths, new_deaths, population
FROM `brave-watch-343605.COVID_data.Death`
WHERE continent is null
ORDER BY 1, 2

--Select the likelihood to death if got COVID in each country, eg. The US
--Total Deaths / Total Cases
SELECT location, date, total_cases, total_deaths, (total_deaths/total_cases)*100 AS DeathPercentage 
FROM `brave-watch-343605.COVID_data.Death`
WHERE location like '%States%'
AND continent is not null 
ORDER BY 1, 2

--Select the percentage of poeple infected to COVID in each country, eg. The US
--Total Cases / Population
SELECT location, date, population, total_cases, (total_cases/population)*100 AS PercentPopulationInfected
FROM `brave-watch-343605.COVID_data.Death`
WHERE location like '%States%' 
AND continent is not null
ORDER BY 1, 2 

--Select the highest infection rate compared to population of each country
SELECT location, population, max(total_cases) as HighestInfectionCount,  max((total_cases/population))*100 as PercentPopulationInfected
FROM `brave-watch-343605.COVID_data.Death`
GROUP BY location, population
ORDER BY PercentPopulationInfected desc

--Select the highest death count per population of each country
SELECT location, population, max(cast(total_deaths as int)) as TotalDeathCount
FROM `brave-watch-343605.COVID_data.Death`
GROUP BY location, population
ORDER BY TotalDeathCount desc

--BREAKING DOWN TO CONTINENT
--Select the highest death count per population of each continent
SELECT continent, max(cast(total_deaths as int)) as TotalDeathCount
FROM `brave-watch-343605.COVID_data.Death`
WHERE continent is not null
GROUP BY continent
ORDER BY TotalDeathCount

--GLOBAL NUMBERS
--Select total cases and deaths and deathrate percentage all over the world
SELECT sum(new_cases) as TotalCases, sum(new_deaths) as TotalDeaths, (sum(cast(new_deaths as int))/sum(new_cases))*100 as Death_Percentage
FROM `brave-watch-343605.COVID_data.Death`
WHERE continent is not null 
ORDER BY Death_Percentage

--Show Percentage of Population that has recieved at least one Covid Vaccine
SELECT d.continent, d.location, d.date, d.population, sum(v.new_vaccinations) OVER(PARTITION BY d.location ORDER BY d.location, d.date) as RollingPeopleVaccinated
FROM `brave-watch-343605.COVID_data.Death` as d 
JOIN `brave-watch-343605.COVID_data.Vaccinations` as v
ON d.location = v.location
AND d.date = v.date
where d.continent is NOT null
order by 2,3

--Using CTE
WITH PopvsVac AS(

    SELECT d.continent, d.location, d.date, d.population, sum(v.new_vaccinations) OVER(PARTITION BY d.location ORDER BY d.location, d.date) as RollingPeopleVaccinated
    FROM `brave-watch-343605.COVID_data.Death` as d 
    JOIN `brave-watch-343605.COVID_data.Vaccinations` as v
    ON d.location = v.location
    AND d.date = v.date
    where d.continent is NOT null
    order by 2,3
)
SELECT *, (RollingPeopleVaccinated/population)*100 AS VAC_PERCENTAGE from PopvsVac

--Using TEMP TABLE to perform windown function in previous query
Create Table COVID_data.PercentPopulationVaccinated
AS SELECT dea.continent, dea.location, dea.date, dea.population, vac.new_vaccinations
, SUM(vac.new_vaccinations) OVER (Partition by dea.Location Order by dea.location, dea.Date) as RollingPeopleVaccinated
FROM `brave-watch-343605.COVID_data.Death` dea
JOIN `brave-watch-343605.COVID_data.Vaccinations` vac
	On dea.location = vac.location
	and dea.date = vac.date
--where dea.continent is not null 
--order by 2,3

SELECT *, (RollingPeopleVaccinated/Population)*100
FROM `brave-watch-343605.COVID_data.PercentPopulationVaccinated`

--create view to store data for later visualizations
CREATE VIEW `brave-watch-343605.COVID_data.PercentPopulationVaccinatedView`(continent, location, date, population, new_vaccinations, RollingPeopleVaccinated) AS
    SELECT
     continent, location, date, population, new_vaccinations, RollingPeopleVaccinated
    FROM
      `brave-watch-343605.COVID_data.PercentPopulationVaccinated`
    WHERE
      continent is not null
    ORDER BY 2,3
